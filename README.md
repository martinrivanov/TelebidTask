# TelebidTask

Форма за регистрация, реализирана на уеб среда като уеб приложение. Използваните технологии за изработката му са C# за управление на сървърната част, SQL за създаването на базата данни на приложението и библиотеката ReactJS за клиентската част.

## Сървърна част

Сървърната част най-общо казано бива разделена на три слоя: API, Services и Data. В API слоя получаваме заявките от клиента и след обработка на информацията от по-долните слоеве бива изпратен отговор обратно до него. В Services слоя са имплементирани използваните услуги за обработка на заявките от API слоя. В него е имплементирана цялостната логика, седяща зад API методите. В Data слоя имаме директна връзка с базата данни, като в нея както записваме информация, така и я получаваме и обработваме. Към тази част са добавени и два тестови проекта за API и Services слоя.

### Модели

Моделите на приложението са:

User:
- Guid Id
- string Name
- string Email
- string Password
- string Salt

UserDTO:
- Guid Id
- string Name
- string Email

RegistrationUserModel:
- string Name
- string Email
- string Password

LoginCredentials:
- string Email
- string Password


### API

Методите на API-то са имплементирани в IdentityController.cs, като те са:

- GetUserById(Guid id) - GET метод който приема Id на потребителя и връща информацията за него при съществуващо Id, докато в другия случай връща грешка от тип NotFound
- UpdateUser(Guid id, JsonPatchDocument<User> patch) - PATCH метод, който приема потребителско Id, както и JsonPatchDocument<User>, който улеснява правенето на PATCH заявки (пример за JsonPatchDocument<User> заявка - {"op": "replace", "path": "/name", value: "NewName"}), и модифицира информацията за потребителя спрямо зададените параметри, ако такова Id съществува в базата данни, или NotFound, ако не съществува
- Register(RegistrationUserModel registration) - POST метод, който приема регистрационен модел на потребител, в която се съдържат всички необходими данни за регистрация, и създава нов потребител при условие, че подаденият имейл не съществува вече в базата
- Login(LoginCredentials credentials) - POST метод, който приема данните от Login полето, проверява дали съществува такъв потребител и дали паролите съвпадат и при успешен резултат връща userId, а при неуспешен връща BadRequest
- Logout() - POST метод, който сигнализира за излизане от сегашния потребител

В този слой също така се намират настройките за сървърната част, като регистриране на връзка между услугите и техните интерфейси за имплементиране на Dependency Injection, както и позволяването на употребата на API-то от клиентската част чрез CORS.


### Services

Услугите в това приложение са две: PasswordService и UserService. Първата услуга се отнася за хеширането на потребителските пароли за по-сигурното им съхранение. Втората услуга се обработва заявките, изпратени от потребителя, като в нея е поставена цялостната логика на сървърната част. Методите от тези услуги са:

#### PasswordService

- GenerateSalt() - генерира така наречената "сол", чрез която е уникална за всеки потребител и е добавена към паролата, за да бъдат създадени по-сложни хешове за паролите, като връща като резултат byte[]
- GeneratePasswordHash(string password, byte[] salt) - създаваме хеш за паролата чрез хеш-функцията SHA-256, като първо се взимат битовете от паролата, след което към тях бива прибавена "солта", после новополучената парола се хешира и към нея пак се добавя тази "сол" в началото на паролата и финалната парола бива превърната в String

#### UserService

- GetUserById(Guid id) - методът прави заявка до Data слоя за търсене на потребител с конкретното Id, като при успешен резултат бива върнат потребителя под формата на UserDTO (User Data Transfer Object), а при неуспешен връща null
- Login(LoginCredentials credentials) - методът прави заявка до Data слоя за търсене на потребител с конкретният имейл, като при неуспешен резултат се връща null, но при успешен резултат, получената от потребителя парола се хешира с неговата "сол" и нейния хеш се сравнява с този, записан в базата данни, като при неуспешен резултат отново се връща null, а при успешен се връща потребителя като UserDTO
- Register(RegistrationModel registrationModel) - методът прави заявка за търсене на потребител по имейл, като ако такъв бъде открит, се връща null, докато в обратния случай подадената парола от потребителската заявка ще бъде хеширана, като за потребителя ще бъде създадена "сол", и след това ще се направи заявка до базата да бъде създаден този потребител, като при неуспешно създаване се връща null, а при успешно - UserDTO на потребителя
- UpdateUser(Guid id, JsonPatchDocument<User> patch) - методът първо търси за потребител с такова Id, като връща null при неуспешен опит, но ако бъде открит такъв потребител, след това се създава копие на потребителската информация, за да може да имаме копие на потребителя преди да приложим patch върху него и така в случай, че паролата бива подменена с нова, то тази парола ще се хешира; след това се прави заявка за модифициране на потребителската информация и връща UserDTO модел
- MakeUserCopy(User user) - прави копие на вече съществуващ обект User
- MapUserToUserDTO(User user) - превръща обект User в UserDTO


### Data

В този слой имаме директна връзка с базата данни. В така нареченото DatabaseRepository са имплементирани най-основните методи за по-лесна употреба от услугите, като се викат изготвени Stored Procedures от базата данни. Връзката до базата данни се осъществява чрез ADO.NET. Методите от DatabaseRepository са:

- CreateUser(User user) - в този метод се създава нов потребител чрез процедурата createUser, като след нейното изпълнение се връщат броят променени редове и ако той е по-голям от нула, връщаме новия потребител, а в противен случай се връща null; в допълнение към това тук се създава и потребителското Id
- GetUserByEmail(string email) - в този метод се изважда потребител по неговия имейл чрез процедурата getUsersWithEmail, като при успешно изпълнение връща съществуващ потребител, а при неуспешно връща null
- GetUserById(Guid id) - в този метод се изважда потребител по неговото Id чрез процедурата getUserById, като при успешно изпълнение връща съществуващ потребител, а при неуспешно връща null
- UpdateUser(Guid id, User user) - в този метод се модифицира информацията на даден потребител чрез процедурата updateUserInfo


### Stored Procedures

- getUserById @Id UNIQUEIDENTIFIER - процедура, която избира всички потребители, чието Id е равно на подаденото
- getUsersWithEmail @Email NVARCHAR(MAX) - процедура, която избира всички потребители, чийто имейл е равен на подадения
- createUser @Id UNIQUEIDENTIFIER, @Name NVARCHAR(MAX), @Email NVARCHAR(MAX), @Password NVARCHAR(MAX), @Salt NVARCHAR(MAX) - процедура, която създава потребител на база подадените параметри
- updateUserInfo @Id UNIQUEIDENTIFIER, @Name NVARCHAR(MAX), @Email NVARCHAR(MAX), @Password NVARCHAR(MAX) - процедура, която модифицира информацията за потребителя с подаденото Id



## Потребителска част

Потребителската част на приложението е изготвена чрез библиотеката ReactJS, поради лесното създаване и използване на компоненти, както и различни функционалности, чрез които може да се контролира по-лесно какво бива визуализирано на екрана. За да се осъществи връзката с API-то съм използвал библиотеката axios, чрез която заявките, изпращани към сървъра, са по-лесни и удобни. 

### Папка components

Тук се съдържат всички използвани компоненти в приложението, а те са:

- Login.js - в този компонент е създадена форма с Captcha за влизане във вече създаден потребител, като при успешно влизане се пази "сесия" за потребителя, която; този компонент прави заявка до Login() метода
- - нещо
- Navbar.js - този компонент е навигационен бар за лесно преминаване между login и регистрационна форма
- Register.js - в този компонент е създадена регистрационна форма, като в нея се валидират подадените от потребителя данни; този компонент прави заявка до Register() метода
- UserDashboard.js - в този компонент се показва информация за току-що влезналия потребител, като той има правото да я модифицира и нововъведените данни също се валидират, и също така в този компонент се случва и излизането от профила и проверката за изтичане на "сесията"; този компонент прави връзка до GetUserById(), UpdateUser() и Logout() методи

### Папка data

В тази папка се намира файлът endpoints.js, в която се пазят всички връзки с API-то.

### Папка captcha-service

В тази папка се намира файлът captcha.js, в който се създава изображение със символи, избрани на случаен принцип. Методите от този файл са:

- generateCaptchaText() - генерира текст от 6 буквено-цифрови символа, избрани на случаен принцип
- drawCaptcha(ctx, text) - създава изображение на даден текст, чийто символи по вертикал са подредени на случаен принцип; създаденото изображение се записва в <canvas>

### Папка validation-service

В тази папка се намира файлът validate.js, в който се съдържат проверките за валидация, както и грешките, които могат да бъдат върнати. Методите от този файл са:

- validateName(name) - проверява дали даденото име съдържа букви и дали първата буква е главна
- validateEmail(email) - проверява дали даден имейл е валиден, като проверката става чрез regex шаблон, и дали имейлът не е празен
- validatePassword(password) - проверява дали дадена парола е с над 6 символа, дали съдържа поне една цифра или специален символ (като проверката отново става чрез regex шаблон) и дали паролата не е празна

### Папка config

В нея се съдържа файлът axios.js, в която axios бива настроена.
